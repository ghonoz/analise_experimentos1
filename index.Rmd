---
title: "Tarefa ANOVA"
author: "Gabriel Lopes Rubinho"
date: '17-01-2024'
output: 
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    theme: united
    highlight: tango

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Aplicação do teste de Levene Modificado
Primeiramente, será feita uma introdução do que se é o teste de Levene Modificado.

Em Análise de Variância, se é de interesse que as variâncias sejam as homoscedásticas, ou seja, que os resíduos não cresçam conforme se aumenta o valor predito ($\hat{y_{ij}} = \bar{y_{i.}}$). Um dos testes para verificar se as variâncias são iguais, ou se há diferença entre um dos grupos, é o teste de Barlett, com as hipóteses


\[
\begin{aligned}
& H_0: \sigma_{1}^{2} = \sigma_{2}^2 = ... = \sigma_{a}^2\\
& H_a: \text{Há pelo menos uma variância que não seja igual a outra}
\end{aligned}
\]

No entanto, as amostras dos grupos devem seguir distribuição normal e, para esse teste, é um pressuposto crítico. No caso, o teste de Levene ignora esse pressuposto, e é uma alternativa no caso de não haver normalidade.

No caso, precisaremos transformar os dados, na seguinte maneira:

$d_{ij} = |y_{ij} - \tilde{y_{i}}|$, onde $i = 1, 2, ..., a$, e $j = 1, 2, ..., n_{i}$, onde $a$ é o número de grupos, $n_{i}$ o tamanho de amostras para determinado grupo i, e $\tilde{y_{i}}$ é a mediana do tratamento i.


## Exemplo 3.5

Não será construída a tabela por questões de praticidade, mas os valores serão colocados em código. 



``` {r}

estimation_method1 <- c(0.34, 0.12, 1.23, 0.7, 1.75, .12)
median_method1 <- median(estimation_method1)
estimation_method2 <- c(0.91, 2.94, 2.14, 2.36, 2.86, 4.55)
median_method2 <- median(estimation_method2)

estimation_method3 <-  c(6.31, 8.37, 9.75, 6.09, 9.82, 7.24)
median_method3 <- median(estimation_method3)

estimation_method4 <- c(17.15, 11.82, 10.95, 17.2, 14.35, 16.82)
median_method4 <- median(estimation_method4)

estimation_method1_levene <- abs(estimation_method1 - median_method1)
estimation_method2_levene <- abs(estimation_method2 - median_method2)
estimation_method3_levene <- abs(estimation_method3 - median_method3)
estimation_method4_levene <- abs(estimation_method4 - median_method4)

obs <- c(estimation_method1_levene, estimation_method2_levene, estimation_method3_levene, estimation_method4_levene)

estimation_method <- as.factor(sort(rep(seq(1, 4, 1), times = 6)))
df <- data.frame(estimation_method, obs)
df
```

Temos que o total de elemento por fator é 5. Vamos aplicar o teste F:

A fórmula de F pode ser escrita como 
$$F_{0} = \frac{MS_{treatments}}{MS_{E}}$$ onde $$MS_{treatments} = \frac{SS_{treatments}}{a-1}$$ e $$MS_{E} = \frac{SS_{E}}{N-a}$$, onde $a$ é o número de fatores, e N é o número total de observações.
Além disso, $$SS_{e} = \sum_{i=1}^{a}\sum_{j=1}^{n}(y_{ij} - \bar{y_{..}})^{2}$$ e $$SS_{treatments} = n\sum_{i=1}^{a}(\bar{y_{i.}} - \bar{y_{..}})^{2}$$
 $y_{..}$ pode ser entendido como a soma geral de todos os valores, $y_{i.}$ a soma de todos os valores em determinado fator $i$, $n$ o total de elementos em cada fator.
 
```{r}
plot(obs~estimation_method, data = df)
```


Através do `dplyr`, podemos utilizar funções que nos agilizam em retirar estatísticas referentes a cada um dos fatores.

``` {r, warning = FALSE, message = FALSE}
library(dplyr)

stat <- df %>%
  group_by(estimation_method) %>%
  summarise(media = mean(obs),
            variancia = var(obs),
            total = sum(obs))
stat

```
O total de elemento por fator é $n=6$.

```{r}
n <- 6
y__ <- sum(df$obs)
y__mean <- y__/nrow(df)

SS_treatments <- n*sum((stat$media - y__mean)^2)
MS_treatments <- SS_treatments/3

SS_t <- sum(df$obs^2) - ((sum(stat$total))^2)/nrow(df)

SS_e <- SS_t - SS_treatments

MS_e <- SS_e/(nrow(df)-4)


MS_treatments
MS_e



```
Portanto, $MS_{treatments} = 3.85656$ e $MS_{E} = 0.8441742$. 

Do teste, $F_{0} = \frac{3.85656}{0.8441742} = 4.568441$

Rejeitamos $H_{0}$ e concluímos que há evidências de que pelo menos uma das variâncias é diferente se 

\begin{center}
$F_{0} > F_{\alpha, a-1, N-a}$
\end{center}

No nosso caso, $F_{\alpha, a-1, N-a} = F_{0.05, 3, 20} = 3.10$ 

Como $F_{0} = 4.568441 > F_{0.05, 3, 20} = 3.10$, rejeitamos a hipótese nula de que as variâncias são homogêneas. 
